syntax = "proto3";

package controlplane.v1;

option go_package = "github.com/sebastianm/flowgentic/internal/proto/gen/controlplane/v1;controlplanev1";

// ThreadService provides CRUD operations for managing thread
// configurations on the control plane.
service ThreadService {
  // ListThreads returns all threads for a given project.
  rpc ListThreads(ListThreadsRequest) returns (ListThreadsResponse) {}

  // GetThread returns a single thread by ID.
  rpc GetThread(GetThreadRequest) returns (GetThreadResponse) {}

  // CreateThread registers a new thread.
  rpc CreateThread(CreateThreadRequest) returns (CreateThreadResponse) {}

  // UpdateThread modifies an existing thread configuration.
  rpc UpdateThread(UpdateThreadRequest) returns (UpdateThreadResponse) {}

  // DeleteThread removes a thread by ID.
  rpc DeleteThread(DeleteThreadRequest) returns (DeleteThreadResponse) {}

  // WatchThreadUpdates streams real-time thread updates (e.g. topic changes).
  rpc WatchThreadUpdates(WatchThreadUpdatesRequest) returns (stream WatchThreadUpdatesResponse) {}

  // ArchiveThread sets or clears the archived flag on a thread.
  rpc ArchiveThread(ArchiveThreadRequest) returns (ArchiveThreadResponse) {}
}

// ThreadConfig describes a thread.
message ThreadConfig {
  string id = 1;
  string project_id = 2;
  string agent = 3;
  string model = 4;
  string created_at = 5;
  string updated_at = 6;
  string mode = 7;
  string topic = 8;
  bool archived = 9;
  string plan = 10;
}

message ListThreadsRequest {
  string project_id = 1;
}

message ListThreadsResponse {
  repeated ThreadConfig threads = 1;
}

message GetThreadRequest {
  string id = 1;
}

message GetThreadResponse {
  ThreadConfig thread = 1;
}

message CreateThreadRequest {
  string id = 1;
  string project_id = 2;
  string agent = 3;
  string model = 4;
  // Optional prompt to kick off an agent run immediately.
  string prompt = 5;
  // Thread mode (e.g. "single_agent", "orchestrated").
  string mode = 6;
  // Worker to dispatch the initial agent run to.
  string worker_id = 7;
  // Session mode (e.g. "ask", "architect", "code").
  string session_mode = 8;
}

message CreateThreadResponse {
  ThreadConfig thread = 1;
}

message UpdateThreadRequest {
  string id = 1;
  string agent = 2;
  string model = 3;
  string plan = 4;
}

message UpdateThreadResponse {
  ThreadConfig thread = 1;
}

message DeleteThreadRequest {
  string id = 1;
}

message DeleteThreadResponse {}

message ArchiveThreadRequest {
  string id = 1;
  bool archived = 2;
}

message ArchiveThreadResponse {
  ThreadConfig thread = 1;
}

enum ThreadEventType {
  THREAD_EVENT_TYPE_UNSPECIFIED = 0;
  THREAD_EVENT_TYPE_CREATED = 1;
  THREAD_EVENT_TYPE_UPDATED = 2;
  THREAD_EVENT_TYPE_REMOVED = 3;
}

message WatchThreadUpdatesRequest {}

message WatchThreadUpdatesResponse {
  ThreadEventType event_type = 1;
  ThreadConfig thread = 2;
}
